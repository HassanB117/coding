<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IP Info — Rebuilt</title>
  <link rel="icon" href="data:;base64,iVBORw0KGgo="> <!-- tiny blank icon to avoid 404s -->
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg-1:#0b0b0d;
      --bg-2:#121214;
      --panel:#161616ee;
      --accent:#00ffc8;
      --muted:#9aa6a6;
      --glass: rgba(255,255,255,0.02);
      --radius:14px;
      font-synthesis: none;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;min-height:100%;
      font-family:"Rubik",system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background: linear-gradient(180deg,var(--bg-1),var(--bg-2));
      color:#e9ffff;display:flex;align-items:center;justify-content:center;padding:28px;
    }

    .card{
      width:100%;max-width:1100px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.2));
      border-radius:var(--radius);padding:18px;display:grid;grid-template-columns:1fr 420px;gap:18px;box-shadow:0 8px 30px rgba(0,0,0,0.6);
      border:1px solid rgba(255,255,255,0.03);
    }

    header{display:flex;align-items:center;gap:12px}
    .logo{width:46px;height:46px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#00a8ff);display:flex;align-items:center;justify-content:center;font-weight:700;color:#001;}
    h1{font-size:1.05rem;margin:0}
    p.lead{margin:0;color:var(--muted);font-size:0.92rem}

    .left{padding:6px 8px}
    .data{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;margin-top:12px}
    .item{background:var(--glass);padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.02)}
    .label{display:block;font-size:0.78rem;color:var(--muted);}
    .value{font-weight:600;margin-top:6px;color:#e7fff6;word-break:break-word}

    .controls{display:flex;gap:8px;margin-top:12px}
    button, .link-like{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px 10px;border-radius:10px;color:var(--accent);cursor:pointer;font-weight:600}
    button.secondary{color:var(--muted);border-style:dashed}

    /* map column */
    .right{display:flex;flex-direction:column;gap:10px}
    .map-wrap{flex:1;min-height:320px;background:linear-gradient(180deg, rgba(0,0,0,0.2), rgba(0,0,0,0.35));border-radius:12px;border:1px solid rgba(0,255,200,0.06);overflow:hidden;position:relative}
    #map{width:100%;height:100%;display:block;border:0}
    .map-overlay{position:absolute;left:10px;top:10px;background:rgba(0,0,0,0.45);backdrop-filter:blur(6px);padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}

    footer.note{font-size:0.78rem;color:var(--muted);margin-top:8px}

    .status{display:flex;gap:10px;align-items:center}
    .dot{width:10px;height:10px;border-radius:50%;background:var(--accent);box-shadow:0 0 8px rgba(0,255,200,0.12)}

    /* responsive */
    @media (max-width:980px){.card{grid-template-columns:1fr 360px}}
    @media (max-width:720px){.card{grid-template-columns:1fr;}
      .map-wrap{min-height:260px}
      .data{grid-template-columns:1fr}
    }

    /* small touches */
    .muted{color:var(--muted)}
    .center{text-align:center}

  </style>
</head>
<body>
  <main class="card" role="main">
    <div class="left">
      <header>
        <div class="logo" aria-hidden>IP</div>
        <div>
          <h1>IP Info</h1>
          <p class="lead">Public IPv4 / IPv6, location & network details — rebuilt and improved.</p>
        </div>
      </header>

      <div class="data" aria-live="polite">
        <div class="item">
          <span class="label">IPv4</span>
          <div id="ipv4" class="value">—</div>
        </div>
        <div class="item">
          <span class="label">IPv6</span>
          <div id="ipv6" class="value">—</div>
        </div>
        <div class="item">
          <span class="label">Country</span>
          <div id="country" class="value">—</div>
        </div>
        <div class="item">
          <span class="label">Region</span>
          <div id="region" class="value">—</div>
        </div>
        <div class="item">
          <span class="label">City</span>
          <div id="city" class="value">—</div>
        </div>
        <div class="item">
          <span class="label">ISP / Org</span>
          <div id="isp" class="value">—</div>
        </div>
      </div>

      <div class="controls">
        <button id="refresh" title="Refresh data">Refresh</button>
        <button id="copy-ip" title="Copy IPv4">Copy IPv4</button>
        <button id="copy-ip6" title="Copy IPv6" class="secondary">Copy IPv6</button>
        <button id="pin" class="secondary" title="Toggle map pin">Toggle Pin</button>
      </div>

      <div style="margin-top:12px" class="status">
        <span class="dot" aria-hidden></span>
        <span class="muted">Data fetched from public IP services • No keys required</span>
      </div>

      <footer class="note">Small privacy note: these services only return public-facing IP and coarse location data derived from ISP geolocation databases. If data is missing, it is normal.</footer>
    </div>

    <aside class="right" aria-label="Map and extras">
      <div class="map-wrap" id="mapWrap">
        <div class="map-overlay" id="mapOverlay">Map • Loading…</div>
        <iframe id="map" title="Map" srcdoc="<p style=\"color:#ddd;padding:12px;font-family:system-ui;\">Map unavailable in this preview. Enable JS to load map.</p>"></iframe>
      </div>

      <div class="center muted">Want a JSON export? <button id="export" class="link-like">Download JSON</button></div>
    </aside>
  </main>

  <script>
    // Small utility functions
    const el = id => document.getElementById(id);
    const set = (id, v) => { const n = el(id); if(n) n.textContent = v ?? '—'; };

    async function fetchJson(url){
      try{ const r = await fetch(url, {cache:'no-store'}); if(!r.ok) throw new Error('bad'); return await r.json(); }
      catch(e){ return null }
    }

    async function updateAll(){
      set('ipv4','Loading...'); set('ipv6','Loading...'); set('country','Loading...'); set('region','Loading...'); set('city','Loading...'); set('isp','Loading...');

      // IPv4
      const ip4 = await fetchJson('https://api.ipify.org?format=json');
      if(ip4 && ip4.ip) set('ipv4', ip4.ip); else set('ipv4','Unavailable');

      // IPv6 (api64)
      const ip6 = await fetchJson('https://api64.ipify.org?format=json');
      if(ip6 && ip6.ip) set('ipv6', ip6.ip); else set('ipv6','Unavailable');

      // location data — prefer ipapi.co (CORS friendly) but fallback
      let loc = await fetchJson('https://ipapi.co/json/');
      if(!loc){
        // fallback to ipwho.is
        const ipw = await fetchJson('https://ipwho.is/');
        if(ipw && ipw.success) loc = ipw;
      }

      if(loc){
        set('country', loc.country_name || loc.country || '—');
        set('region', loc.region || loc.region_name || loc.region_code || '-');
        set('city', loc.city || '-');
        set('isp', loc.org || loc.connection?.isp || loc.isp || '-');

        const lat = loc.latitude ?? loc.lat ?? loc.location?.latitude;
        const lon = loc.longitude ?? loc.lon ?? loc.lng ?? loc.location?.longitude;

        loadMap(lat, lon);
      } else {
        set('country','Unavailable'); set('region','-'); set('city','-'); set('isp','-');
        document.getElementById('mapOverlay').textContent = 'Location unavailable';
      }
    }

    function loadMap(lat,lon){
      const iframe = document.getElementById('map');
      const overlay = document.getElementById('mapOverlay');
      if(!lat || !lon){ overlay.textContent = 'No coordinates to show'; return }
      overlay.textContent = `${lat.toFixed(4)}, ${lon.toFixed(4)}`;

      // Use OpenStreetMap embed (no API key) with a small marker via URL
      const z = 10;
      const src = `https://www.openstreetmap.org/export/embed.html?bbox=${lon-0.05}%2C${lat-0.05}%2C${lon+0.05}%2C${lat+0.05}&layer=mapnik&marker=${lat}%2C${lon}`;
      iframe.src = src;

      // once map loads, remove overlay after short delay
      iframe.onload = () => {
        setTimeout(()=>{overlay.style.display='none'},600);
      };
      iframe.onerror = () => { overlay.textContent = 'Failed to load map'; }
    }

    // copy helpers
    document.getElementById('copy-ip').addEventListener('click', ()=>{
      const v = document.getElementById('ipv4').textContent;
      navigator.clipboard?.writeText(v).then(()=>{alert('IPv4 copied: '+v)}, ()=>{prompt('Copy IPv4', v)});
    });
    document.getElementById('copy-ip6').addEventListener('click', ()=>{
      const v = document.getElementById('ipv6').textContent;
      navigator.clipboard?.writeText(v).then(()=>{alert('IPv6 copied: '+v)}, ()=>{prompt('Copy IPv6', v)});
    });

    // refresh
    document.getElementById('refresh').addEventListener('click', ()=>{ updateAll(); });

    // export JSON
    document.getElementById('export').addEventListener('click', ()=>{
      const data = {
        ipv4: document.getElementById('ipv4').textContent,
        ipv6: document.getElementById('ipv6').textContent,
        country: document.getElementById('country').textContent,
        region: document.getElementById('region').textContent,
        city: document.getElementById('city').textContent,
        isp: document.getElementById('isp').textContent,
        fetched: new Date().toISOString()
      };
      const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'ip-info.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    // pin toggle (just toggles overlay visibility)
    document.getElementById('pin').addEventListener('click', ()=>{
      const ov = document.getElementById('mapOverlay'); ov.style.display = (ov.style.display==='none')? 'block':'none';
    });

    // init
    updateAll();

    // progressive enhancement: if framed or previewed, show a helpful title in the iframe via srcdoc fallback
  </script>
</body>
</html>
